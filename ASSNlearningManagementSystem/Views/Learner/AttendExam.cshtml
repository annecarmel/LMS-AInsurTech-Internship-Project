@model IEnumerable<ASSNlearningManagementSystem.Models.ExamQuestionViewModel>

<div class="container my-4">
    <h2 class="mb-4">Attend Exam</h2>

    @* ✅ Success message block *@
    @if (ViewBag.SuccessMessage != null)
    {
        <div class="alert alert-success">
            @ViewBag.SuccessMessage
        </div>
    }

    @if (!Model.Any())
    {
        <div class="alert alert-warning">No questions available for this exam.</div>
    }
    else
    {
        <form asp-action="AttendExam" asp-controller="Learner" asp-route-examId="@ViewBag.ExamID" method="post">
            @for (int i = 0; i < Model.Count(); i++)
            {
                var question = Model.ElementAt(i);
                <div class="card mb-3 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <strong>Question @question.QuestionId</strong>: @question.QuestionText
                        <span class="float-end">[Marks: @question.Marks]</span>
                    </div>
                    <div class="card-body">
                        <input type="hidden" name="answers[@i].QuestionId" value="@question.QuestionId" />

                        @if (question.QuestionType?.ToLower() == "mcq")
                        {
                            @foreach (var option in question.Options)
                            {
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio"
                                           name="answers[@i].SelectedOptionId"
                                           value="@option.OptionId"
                                           id="option_@option.OptionId" />
                                    <label class="form-check-label" for="option_@option.OptionId">
                                        @option.OptionText
                                    </label>
                                </div>
                            }
                        }
                        else if (question.QuestionType?.ToLower() == "descriptive")
                        {
                            <div class="form-group">
                                <label for="answerText_@i" class="form-label">Your Answer:</label>
                                <textarea name="answers[@i].AnswerText" class="form-control" id="answerText_@i" rows="4" placeholder="Type your answer here..."></textarea>
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-danger">
                                Unknown question type for Question @question.QuestionId.
                            </div>
                        }
                    </div>
                </div>
            }
            <button type="submit" class="custom-btn custom-btn-primary">Submit Answers</button>
        </form>
    }
</div>
