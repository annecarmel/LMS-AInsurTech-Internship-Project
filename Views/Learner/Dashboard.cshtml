@model ASSNlearningManagementSystem.Models.ViewLearnerModel

@{
    Layout = "_LeanersLayout";
    ViewData["Title"] = "Dashboard";
}

<head>
    <link rel="stylesheet" href="~/css/style.css" />
    <link rel="stylesheet" href="~/css/responsive.css" />
</head>

<main>
    <div class="container">
        <div class="dashboard-contents">

            <!-- Small Cards Section -->
            <div class="hero_section">
                <div class="number_card">
                    <div class="card1">
                        <div class="card1_left">
                            <img src="~/img/Policies.png" alt="Policies Icon" />
                        </div>
                        <div class="card1_right">
                            <h6>Courses Enrolled</h6>
                            <h1>@Model.Enrollments?.Count()</h1>
                        </div>
                    </div>
                    <div class="card2">
                        <div class="card2_left">
                            <img src="~/img/Claims.png" alt="Claims Icon" />
                        </div>
                        <div class="card2_right">
                            <h6>Total Courses</h6>
                            <h1>@Model.Courses?.Count()</h1>
                        </div>
                    </div>
                    <div class="card3">
                        <div class="card3_left">
                            <img src="~/img/Settlement.png" alt="Exam Icon" />
                        </div>
                        <div class="card3_right">
                            <h6>Exams to Attend</h6>
                            <h1>@Model.ExamCount</h1>
                        </div>
                    </div>


                </div>
            </div>

            <!-- Charts and Tables Section -->
            <div class="table_card" style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;">

                <!-- Bar Chart: Course Enrollments -->
                <div class="motor_card_box" style="flex: 1 1 48%;">
                    <div class="details">
                        <div class="details-header">
                            <h3>Your Perfomance</h3>
                        </div>
                        <div class="chart-container" style="width:100%; height:400px;">
                            <canvas id="barChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Pie Chart: Courses Distribution -->
                <div class="motor_card_box" style="flex: 1 1 48%;">
                    <div class="details">
                        <div class="details-header">
                            <h3>Popular Courses</h3>
                        </div>
                        <div class="chart-container" style="width:100%; height:400px;">
                            <canvas id="pieChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Enrollments Table -->
                <div class="motor_card_box" style="flex: 1 1 48%;">
                    <div class="details">
                        <div class="details-header">
                            <h3>Your Active Courses</h3>
                        </div>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Course ID</th>
                                        <th>Completion Status</th>
                                        <th>Enrolled On</th>
                                        <th>Completed On</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var e in Model.Enrollments)
                                    {
                                        <tr>
                                            <td>@e.CourseId</td>
                                            <td>In Progress</td> <!-- Replace with actual status when available -->
                                            <td>@e.EnrolledOn.ToString("yyyy-MM-dd")</td>
                                            <td>@(e.CompletedOn?.ToString("yyyy-MM-dd") ?? "N/A")</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Exam Results Table -->
                <div class="motor_card_box" style="flex: 1 1 48%;">
                    <div class="details">
                        <div class="details-header">
                            <h3>Your Exam Results</h3>
                        </div>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Exam ID</th>
                                        <th>Exam Title</th>
                                        <th>Max Marks</th>
                                        <th>Marks Obtained</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var result in Model.Results ?? new List<ASSNlearningManagementSystem.Models.ResultViewModel>())
                                    {
                                        <tr>
                                            <td>@result.ExamId</td>
                                            <td>@result.ExamTitle</td>
                                            <td>@result.MaxMarks</td>
                                            <td>@result.MarksObtained</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>
</main>
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
                // ------------------ BAR CHART: Marks Obtained vs Max Marks ------------------
                const barLabels = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(
                               Model.Results?.Select(r => r.ExamTitle) ?? new List<string>()
               ));

        const marksObtained = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(
                       Model.Results?.Select(r => r.MarksObtained) ?? new List<int>()
                ));

        const maxMarks = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(
                            Model.Results?.Select(r => r.MaxMarks) ?? new List<int>()
            ));

        const barColors = [
            'rgba(255, 99, 132, 0.7)',
            'rgba(54, 162, 235, 0.7)',
            'rgba(255, 206, 86, 0.7)',
            'rgba(75, 192, 192, 0.7)',
            'rgba(153, 102, 255, 0.7)',
            'rgba(255, 159, 64, 0.7)'
        ];

                new Chart(document.getElementById('barChart'), {
                    type: 'bar',
                    data: {
                        labels: barLabels,
                        datasets: [
                            {
                                label: 'Marks Obtained',
                                data: marksObtained,
                                backgroundColor: barColors,
                                borderColor: 'rgba(0,0,0,0.1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Max Marks',
                                data: maxMarks,
                                backgroundColor: 'rgba(200,200,200,0.5)',
                                borderColor: 'rgba(0,0,0,0.1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                stepSize: 1,
                                ticks: {
                                    precision: 0 // makes it integer scale
                                },
                                title: { display: true, text: 'Marks' }
                            },
                            x: {
                                title: { display: true, text: 'Exam Title' }
                            }
                        }
                    }
                });

                // ------------------ PIE CHART: Popular Courses ------------------
                const pieLabels = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(
                   Model.PopularCourses?.Keys.ToList() ?? new List<string>()
                ));

        const pieData = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(
                             Model.PopularCourses?.Values.ToList() ?? new List<int>()
             ));

        const pieColors = [
            'rgba(255, 99, 132, 0.7)',
            'rgba(54, 162, 235, 0.7)',
            'rgba(255, 206, 86, 0.7)',
            'rgba(75, 192, 192, 0.7)',
            'rgba(153, 102, 255, 0.7)',
            'rgba(255, 159, 64, 0.7)'
        ];

                new Chart(document.getElementById('pieChart'), {
                    type: 'pie',
                    data: {
                        labels: pieLabels,
                        datasets: [{
                            label: 'Enrollments',
                            data: pieData,
                            backgroundColor: pieColors
                        }]
                    },
                    options: {
                        responsive: true
                    }
                });
    </script>
}